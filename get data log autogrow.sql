
/*
TextData	ntext	no	16	     	     	yes	(n/a)	(n/a)	SQL_Latin1_General_CP1_CI_AS
BinaryData	image	no	16	     	     	yes	(n/a)	(n/a)	NULL
DatabaseID	int	no	4	10   	0    	yes	(n/a)	(n/a)	NULL
TransactionID	bigint	no	8	19   	0    	yes	(n/a)	(n/a)	NULL
LineNumber	int	no	4	10   	0    	yes	(n/a)	(n/a)	NULL
NTUserName	nvarchar	no	512	     	     	yes	(n/a)	(n/a)	SQL_Latin1_General_CP1_CI_AS
NTDomainName	nvarchar	no	512	     	     	yes	(n/a)	(n/a)	SQL_Latin1_General_CP1_CI_AS
HostName	nvarchar	no	512	     	     	yes	(n/a)	(n/a)	SQL_Latin1_General_CP1_CI_AS
ClientProcessID	int	no	4	10   	0    	yes	(n/a)	(n/a)	NULL
ApplicationName	nvarchar	no	512	     	     	yes	(n/a)	(n/a)	SQL_Latin1_General_CP1_CI_AS
LoginName	nvarchar	no	512	     	     	yes	(n/a)	(n/a)	SQL_Latin1_General_CP1_CI_AS
SPID	int	no	4	10   	0    	yes	(n/a)	(n/a)	NULL
Duration	bigint	no	8	19   	0    	yes	(n/a)	(n/a)	NULL
StartTime	datetime	no	8	     	     	yes	(n/a)	(n/a)	NULL
EndTime	datetime	no	8	     	     	yes	(n/a)	(n/a)	NULL
Reads	bigint	no	8	19   	0    	yes	(n/a)	(n/a)	NULL
Writes	bigint	no	8	19   	0    	yes	(n/a)	(n/a)	NULL
CPU	int	no	4	10   	0    	yes	(n/a)	(n/a)	NULL
Permissions	bigint	no	8	19   	0    	yes	(n/a)	(n/a)	NULL
Severity	int	no	4	10   	0    	yes	(n/a)	(n/a)	NULL
EventSubClass	int	no	4	10   	0    	yes	(n/a)	(n/a)	NULL
ObjectID	int	no	4	10   	0    	yes	(n/a)	(n/a)	NULL
Success	int	no	4	10   	0    	yes	(n/a)	(n/a)	NULL
IndexID	int	no	4	10   	0    	yes	(n/a)	(n/a)	NULL
IntegerData	int	no	4	10   	0    	yes	(n/a)	(n/a)	NULL
ServerName	nvarchar	no	512	     	     	yes	(n/a)	(n/a)	SQL_Latin1_General_CP1_CI_AS
EventClass	int	no	4	10   	0    	yes	(n/a)	(n/a)	NULL
ObjectType	int	no	4	10   	0    	yes	(n/a)	(n/a)	NULL
NestLevel	int	no	4	10   	0    	yes	(n/a)	(n/a)	NULL
State	int	no	4	10   	0    	yes	(n/a)	(n/a)	NULL
Error	int	no	4	10   	0    	yes	(n/a)	(n/a)	NULL
Mode	int	no	4	10   	0    	yes	(n/a)	(n/a)	NULL
Handle	int	no	4	10   	0    	yes	(n/a)	(n/a)	NULL
ObjectName	nvarchar	no	512	     	     	yes	(n/a)	(n/a)	SQL_Latin1_General_CP1_CI_AS
DatabaseName	nvarchar	no	512	     	     	yes	(n/a)	(n/a)	SQL_Latin1_General_CP1_CI_AS
FileName	nvarchar	no	512	     	     	yes	(n/a)	(n/a)	SQL_Latin1_General_CP1_CI_AS
OwnerName	nvarchar	no	512	     	     	yes	(n/a)	(n/a)	SQL_Latin1_General_CP1_CI_AS
RoleName	nvarchar	no	512	     	     	yes	(n/a)	(n/a)	SQL_Latin1_General_CP1_CI_AS
TargetUserName	nvarchar	no	512	     	     	yes	(n/a)	(n/a)	SQL_Latin1_General_CP1_CI_AS
DBUserName	nvarchar	no	512	     	     	yes	(n/a)	(n/a)	SQL_Latin1_General_CP1_CI_AS
LoginSid	image	no	16	     	     	yes	(n/a)	(n/a)	NULL
TargetLoginName	nvarchar	no	512	     	     	yes	(n/a)	(n/a)	SQL_Latin1_General_CP1_CI_AS
TargetLoginSid	image	no	16	     	     	yes	(n/a)	(n/a)	NULL
ColumnPermissions	int	no	4	10   	0    	yes	(n/a)	(n/a)	NULL
LinkedServerName	nvarchar	no	512	     	     	yes	(n/a)	(n/a)	SQL_Latin1_General_CP1_CI_AS
ProviderName	nvarchar	no	512	     	     	yes	(n/a)	(n/a)	SQL_Latin1_General_CP1_CI_AS
MethodName	nvarchar	no	512	     	     	yes	(n/a)	(n/a)	SQL_Latin1_General_CP1_CI_AS
RowCounts	bigint	no	8	19   	0    	yes	(n/a)	(n/a)	NULL
RequestID	int	no	4	10   	0    	yes	(n/a)	(n/a)	NULL
XactSequence	bigint	no	8	19   	0    	yes	(n/a)	(n/a)	NULL
EventSequence	bigint	no	8	19   	0    	yes	(n/a)	(n/a)	NULL
BigintData1	bigint	no	8	19   	0    	yes	(n/a)	(n/a)	NULL
BigintData2	bigint	no	8	19   	0    	yes	(n/a)	(n/a)	NULL
GUID	uniqueidentifier	no	16	     	     	yes	(n/a)	(n/a)	NULL
IntegerData2	int	no	4	10   	0    	yes	(n/a)	(n/a)	NULL
ObjectID2	bigint	no	8	19   	0    	yes	(n/a)	(n/a)	NULL
Type	int	no	4	10   	0    	yes	(n/a)	(n/a)	NULL
OwnerID	int	no	4	10   	0    	yes	(n/a)	(n/a)	NULL
ParentName	nvarchar	no	512	     	     	yes	(n/a)	(n/a)	SQL_Latin1_General_CP1_CI_AS
IsSystem	int	no	4	10   	0    	yes	(n/a)	(n/a)	NULL
Offset	int	no	4	10   	0    	yes	(n/a)	(n/a)	NULL
SourceDatabaseID	int	no	4	10   	0    	yes	(n/a)	(n/a)	NULL
SqlHandle	image	no	16	     	     	yes	(n/a)	(n/a)	NULL
SessionLoginName	nvarchar	no	512	     	     	yes	(n/a)	(n/a)	SQL_Latin1_General_CP1_CI_AS
PlanHandle	image	no	16	     	     	yes	(n/a)	(n/a)	NULL
GroupID	int	no	4	10   	0    	yes	(n/a)	(n/a)	NULL
*/

DECLARE @path NVARCHAR(260);
declare @tracefilename nvarchar(260);

SELECT 
    @path = REVERSE(SUBSTRING(REVERSE([path]), 
    CHARINDEX('\', REVERSE([path])), 260)) + N'log.trc'
  FROM    sys.traces

WHERE is_default = 1;



print @path



 --	declare  @TraceFiles TABLE (
	--	NAME VARCHAR(256),
	--	Depth INT,
	--	IsFile BIT
	--)
	---- Get list of files
	--INSERT INTO @TraceFiles
	--EXEC Master.dbo.xp_DirTree @path ,1,1

	--/* now select only the trace files */
	--declare file_cursor cursor for 
	
	--select NAME from @TraceFiles where NAME like '%.trc%'
	--open file_cursor

	--fetch next from file_cursor into @tracefilename

	--while @@fetch_status = 0
	--begin 
	
	set @tracefilename = @path --+ @tracefilename

	print @tracefilename
	
	SELECT 
	case when e.trace_event_id = 92 then 'DB Increase'
	else 'Log Increase' end 
	as 'Increase Type',
	hostname, sessionloginname, databasename, starttime, endtime, textdata, duration as 'Duration (ms)',
	integerdata * 8 /1024.00 as 'Change In Size MB'
	FROM ::fn_trace_gettable(@tracefilename,default)

      inner join sys.trace_events e

            on eventclass = trace_event_id

       INNER JOIN sys.trace_categories AS cat

            ON e.category_id = cat.category_id

--where databasename in 'UnderwritingReporting' or

		where    
		databasename = 'tempdb'
		--and startTime > '2020-02-03 16:00:00.180'
		-- and
		/*  database category 2 log 1 db */
		-- cat.category_id =  2
  
	  /* log grow only */
		and 
		--(
	   --e.trace_event_id  = 93
	  /* data grow only */
	   --or 
	--   e.trace_event_id  = 92)
	  /*data and log grow */
	e.trace_event_id in (92,93)
	 /* dbcc shrink */
	 --or 
	 --(EventClass IN (116) AND (TextData like 'DBCC%SHRINK%' or TextData like '%FREEPROCCACHE%')))
	 /* backup */
	 --or 
	 --( databasename = 'tempdb'  /*and startTime > '2020-02-03 16:00:00.180' */ and EventClass IN (115))
 
	 order by StartTime
	-- and ( databasename = 'DEV_TEST' and startTime > '2020-02-03 16:00:00.180')
	 --and EventSubClass=1)
	/* restores */
	--or 
	--(EventClass IN (115) and EventSubClass=2)

	/*hash warnings */
	--or 
	--EventClass IN (55)

	/* Missing Column Statistics */
	--or 
	--EventClass IN (79)

	/* Find SQL Server Errors for Missing Join Predicates */
	--or 
	--EventClass IN (80)

	/* Find SQL Server Errors for Sort Warnings */
	--or 
	--EventClass IN (69)

	/* Find SQL Server Errors for the ErrorLog */
	--or 
	--EventClass IN (22)


	
--	fetch next from file_cursor into @tracefilename

--	END

--close file_cursor;
--deallocate file_cursor;






